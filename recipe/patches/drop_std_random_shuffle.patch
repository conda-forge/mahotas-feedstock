From 3e927b415ef0f33710fed2fedd2377c207956638 Mon Sep 17 00:00:00 2001
From: Luis Pedro Coelho <luis@luispedro.org>
Date: Fri, 22 Mar 2024 12:06:23 +1000
Subject: [PATCH] ENH Remove use of std::random_shuffle

This has been removed in C++17

closes #146
---
 ChangeLog          | 3 +++
 mahotas/_morph.cpp | 6 ++++--
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/ChangeLog b/ChangeLog
index 5d0a869a..52357b64 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,3 +1,6 @@
+Version 1.4.14 2024-03-22 by luispedro
+	* Update for C++17 (remove use of std::random_shuffle)
+
 Version 1.4.13 2022-06-28 by luispedro
 	* Fix freeimage testing (and make freeimage loading more robust, see #129)
 	* Add GIL fixed (which triggered crashes in newer NumPy versions)
diff --git a/mahotas/_morph.cpp b/mahotas/_morph.cpp
index b1f15885..acfafc43 100644
--- a/mahotas/_morph.cpp
+++ b/mahotas/_morph.cpp
@@ -1,4 +1,4 @@
-// Copyright (C) 2008-2019, Luis Pedro Coelho <luis@luispedro.org>
+// Copyright (C) 2008-2024, Luis Pedro Coelho <luis@luispedro.org>
 // vim: set ts=4 sts=4 sw=4 expandtab smartindent:
 // 
 // License: MIT
@@ -9,6 +9,7 @@
 #include <cstdio>
 #include <limits>
 #include <iostream>
+#include <random>
 
 #include "numpypp/array.hpp"
 #include "numpypp/dispatch.hpp"
@@ -861,7 +862,8 @@ void hitmiss(numpy::aligned_array<T> res, const numpy::aligned_array<T>& input,
     // This is a micro-optimisation for templates with structure
     // It makes it more likely that matching will fail earlier
     // in uniform regions than otherwise would be the case.
-    std::random_shuffle(neighbours.begin(), neighbours.end());
+    std::mt19937 g(12345);
+    std::shuffle(neighbours.begin(), neighbours.end(), g);
     numpy::index_type slack = 0;
     for (npy_intp i = 0; i != N; ++i) {
         while (!slack) {
